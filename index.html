<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- å¼ºåˆ¶é˜²ç¼“å­˜ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>ç‰¡è›äº§å“è°ƒç ”</title>
    
    <!-- 1. æ›´æ¢ä¸ºæ›´ç¨³å®šçš„å›½å†… CDN (360å‰ç«¯åº“) -->
    <script src="https://lib.baomitu.com/vue/3.3.4/vue.global.prod.min.js"></script>
    
    <style>
        /* åŸºç¡€é‡ç½® */
        :root { --primary: #1677ff; --bg: #f5f7fa; --text: #1f2937; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: -apple-system, sans-serif; background-color: var(--bg); color: var(--text); line-height: 1.5; }
        
        /* å¯åŠ¨æ—¶çš„åŠ è½½å±‚ (é˜²æ­¢ç™½å±) */
        #loading-mask {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 9999; display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: #666;
        }
        
        .app-container { max-width: 600px; margin: 0 auto; min-height: 100vh; background: #fff; display: flex; flex-direction: column; }
        
        /* é¡¶éƒ¨ */
        header { padding: 12px 16px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: rgba(255,255,255,0.95); z-index: 100; }
        h1 { font-size: 16px; font-weight: 800; color: #333; margin: 0; }
        .step-badge { font-size: 12px; background: #f0f2f5; padding: 2px 8px; border-radius: 10px; color: #666; }
        .progress-bar { height: 3px; background: #f0f0f0; width: 100%; }
        .progress-fill { height: 100%; background: var(--primary); transition: width 0.3s ease; }

        /* å†…å®¹åŒº */
        main { flex: 1; padding: 20px 16px; overflow-y: auto; padding-bottom: 90px; }
        
        /* é¢˜ç›®æ ·å¼ */
        .q-wrapper { margin-bottom: 20px; }
        .q-keyword { font-size: 20px; font-weight: 900; color: #000; display: block; margin-bottom: 4px; }
        .q-context { font-size: 14px; color: #666; }
        .optional-tag { display: inline-block; font-size: 12px; background: #e6f4ff; color: #1677ff; padding: 1px 5px; border-radius: 4px; margin-left: 5px; vertical-align: middle; transform: translateY(-2px); }

        /* é€‰é¡¹æ ·å¼ */
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .options-grid.compact { grid-template-columns: 1fr 1fr; }
        .option-card { 
            padding: 14px 10px; border: 2px solid #f0f0f0; border-radius: 12px;
            background: #fff; text-align: center; font-size: 15px; font-weight: 500; color: #444;
            transition: all 0.1s; cursor: pointer;
        }
        .option-card:active { background-color: #fafafa; transform: scale(0.98); }
        .option-card.selected { border-color: var(--primary); background-color: #e6f4ff; color: var(--primary); font-weight: 700; }

        /* è§’è‰²å¡ç‰‡ */
        .role-card { display: flex; align-items: center; padding: 24px; margin-bottom: 16px; border: 2px solid #f0f0f0; border-radius: 16px; background: #fff; }
        .role-card:active { transform: scale(0.97); }
        .role-icon { font-size: 40px; margin-right: 16px; }
        .role-title { font-size: 18px; font-weight: 800; color: #333; margin-bottom: 4px; }
        .role-sub { font-size: 13px; color: #888; }

        /* æ»‘å— */
        .slider-container { background: #fafafa; padding: 30px 20px; border-radius: 16px; text-align: center; border: 1px solid #f0f0f0; }
        .price-val { font-size: 42px; font-weight: 900; color: var(--primary); letter-spacing: -1px; }
        .price-unit { font-size: 14px; color: #999; margin-bottom: 20px; }
        input[type=range] { width: 100%; margin: 20px 0; height: 8px; background: #e0e0e0; border-radius: 10px; -webkit-appearance: none; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 32px; height: 32px; background: #fff; border-radius: 50%; border: 4px solid var(--primary); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }

        /* æ–‡æœ¬æ¡† */
        textarea { width: 100%; padding: 16px; border: 2px solid #f0f0f0; border-radius: 12px; font-size: 16px; outline: none; background: #fafafa; }
        textarea:focus { border-color: var(--primary); background: #fff; }

        /* åº•éƒ¨ */
        footer { 
            position: fixed; bottom: 0; left: 0; right: 0; max-width: 600px; margin: 0 auto;
            padding: 12px 16px; background: rgba(255,255,255,0.9); backdrop-filter: blur(5px);
            border-top: 1px solid #f0f0f0; display: flex; gap: 12px; z-index: 50;
            padding-bottom: max(12px, env(safe-area-inset-bottom));
        }
        .btn { border-radius: 12px; font-size: 16px; border: none; font-weight: 700; cursor: pointer; height: 48px; display: flex; align-items: center; justify-content: center; }
        .btn-prev { background: #f5f5f5; color: #999; width: 48px; }
        .btn-next { background: var(--primary); color: #fff; flex: 1; }
        .btn-next:disabled { background: #e0e0e0; color: #aaa; }

        /* çŠ¶æ€é¡µ */
        .status-page { text-align: center; padding-top: 40px; }
        .icon-large { font-size: 72px; margin-bottom: 20px; display: block; }
        .btn-dl { background: #059669; color: white; width: 100%; margin-top: 20px; }
        
        /* é”™è¯¯æ—¥å¿—æ˜¾ç¤º (ç”¨äºè°ƒè¯•ç™½å±) */
        #error-log { display: none; background: #fff0f0; color: red; padding: 20px; font-size: 12px; word-break: break-all; position: fixed; top: 0; left: 0; width: 100%; z-index: 10000; }
    </style>
</head>
<body>

<!-- 1. å¯åŠ¨åŠ è½½å±‚ -->
<div id="loading-mask">
    <div style="font-size: 30px; margin-bottom: 20px;">ğŸ¦ª</div>
    <div>æ­£åœ¨åŠ è½½é—®å·...</div>
    <div style="font-size: 12px; color: #999; margin-top: 10px;">V8.0 çœŸå®æé€Ÿç‰ˆ</div>
</div>

<!-- 2. é”™è¯¯æ—¥å¿— (å¦‚æœç™½å±ä¼šè‡ªåŠ¨æ˜¾ç¤º) -->
<div id="error-log"></div>

<div id="app" class="app-container" style="display: none;">

    <header>
        <h1>ğŸ¯ ç‰¡è›äº§å“è°ƒç ”</h1>
        <div class="step-badge" v-if="step > 0 && step <= totalSteps">{{ step }} / {{ totalSteps }}</div>
    </header>
    <div class="progress-bar" v-if="step > 0 && step <= totalSteps">
        <div class="progress-fill" :style="{ width: progress + '%' }"></div>
    </div>

    <main>
        <!-- 0. è§’è‰² -->
        <div v-if="step === 0">
            <h2 style="font-size: 24px; font-weight: 900; margin-bottom: 8px; text-align: center;">æ‚¨æ˜¯ï¼Ÿ</h2>
            <p style="text-align: center; color: #666; margin-bottom: 30px; font-size: 14px;">è¯·é€‰æ‹©èº«ä»½</p>
            
            <div class="role-card" @click="startSurvey('restaurant')">
                <div class="role-icon">ğŸ‘¨â€ğŸ³</div>
                <div><div class="role-title">é¤å…ç»è¥è€…</div><div class="role-sub">é‡‡è´­ / åå¨ / è€æ¿</div></div>
            </div>
            <div class="role-card" @click="startSurvey('consumer')">
                <div class="role-icon">ğŸ </div>
                <div><div class="role-title">å®¶åº­æ¶ˆè´¹è€…</div><div class="role-sub">è‡ªå·±åšé¥­ / æµ·é²œçˆ±å¥½è€…</div></div>
            </div>
        </div>

        <!-- 1. ç­”é¢˜ -->
        <div v-else-if="step > 0 && step <= totalSteps">
            <div class="q-wrapper">
                <span class="q-keyword">{{ currentQuestion.keyword }} <span v-if="currentQuestion.optional" class="optional-tag">é€‰å¡«</span></span>
                <span class="q-context">{{ currentQuestion.text }}</span>
            </div>

            <template v-if="['single', 'multiple'].includes(currentQuestion.type)">
                <div :class="['options-grid', isCompact(currentQuestion.options) ? 'compact' : '']">
                    <div v-for="(opt, idx) in currentQuestion.options" :key="idx" 
                         @click="handleOptionClick(opt, currentQuestion.type)"
                         :class="['option-card', isSelected(opt) ? 'selected' : '']">
                        {{ opt }}
                    </div>
                </div>
            </template>

            <div v-if="currentQuestion.type === 'slider'" class="slider-container">
                <div class="price-val"><span style="font-size:24px">Â¥</span>{{ tempAnswer }}</div>
                <div class="price-unit">æ¯ç›’ (250g) é¢„æœŸä»·æ ¼</div>
                <input type="range" :min="currentQuestion.min" :max="currentQuestion.max" step="0.5" v-model="tempAnswer">
                <div style="display:flex; justify-content:space-between; color:#999; font-size:12px; font-weight:600;">
                    <span>Â¥{{ currentQuestion.min }}</span><span>Â¥{{ currentQuestion.max }}</span>
                </div>
            </div>

            <div v-if="currentQuestion.type === 'text'">
                <textarea v-model="tempAnswer" rows="5" placeholder="è¯·åœ¨æ­¤è¾“å…¥..."></textarea>
            </div>
        </div>

        <!-- 2. çŠ¶æ€é¡µ -->
        <div v-else class="status-page">
            <div v-if="isSubmitting">
                <div class="icon-large" style="animation: bounce 1s infinite;">ğŸ”„</div>
                <h3>æ­£åœ¨è¿æ¥æœåŠ¡å™¨...</h3>
                <p style="color:#666; font-size:13px;">è¯·å‹¿å…³é—­é¡µé¢ï¼Œé¢„è®¡éœ€ 3-5 ç§’</p>
            </div>

            <div v-else-if="submitSuccess">
                <div class="icon-large">âœ…</div>
                <h3 style="color:var(--primary);">æäº¤æˆåŠŸ</h3>
                <p style="color:#666; margin-bottom: 30px;">æ•°æ®å·²æˆåŠŸä¼ è¾“è‡³åå°ã€‚</p>
                <button @click="resetSurvey" style="background:transparent; border:none; color:var(--primary); font-weight:bold;">å¡«å†™ä¸‹ä¸€ä»½</button>
            </div>

            <div v-else>
                <div class="icon-large">âš ï¸</div>
                <h3>ç½‘ç»œè¿æ¥è¶…æ—¶</h3>
                <p style="color:#666; font-size:13px;">æ— æ³•è¿æ¥è‡³ç¾å›½æœåŠ¡å™¨ï¼Œè¯·æ‰‹åŠ¨ä¿å­˜ï¼š</p>
                <button @click="exportCSV" class="btn btn-dl">ğŸ“¥ ç‚¹å‡»ä¸‹è½½æ•°æ®æ–‡ä»¶</button>
                <button @click="submitData" style="margin-top:20px; background:none; border:none; color:#666; text-decoration:underline;">å†è¯•ä¸€æ¬¡</button>
            </div>
        </div>
    </main>

    <footer v-if="step > 0 && step <= totalSteps">
        <button @click="prevStep" class="btn btn-prev">â†</button>
        <button @click="nextStep" class="btn btn-next">
            {{ getNextBtnText() }}
        </button>
    </footer>

</div>

<script>
    // å…¨å±€é”™è¯¯æ•è· (é˜²æ­¢ç™½å±æ— åé¦ˆ)
    window.onerror = function(msg, url, line) {
        document.getElementById('loading-mask').style.display = 'none';
        const log = document.getElementById('error-log');
        log.style.display = 'block';
        log.innerHTML += `Error: ${msg} (Line: ${line})<br>`;
        return false;
    };

    const { createApp } = Vue;

    const APP_ID = "1iqfzTWgx6IhUOvjOGt5HSqg-MdYXbMMI";
    const APP_KEY = "7r3MYrx91UJEoVBrj1sVATOV";
    const API_URL = "https://1iqfztwg.api.lncldglobal.com/1.1/classes/SurveyData";

    const surveyDb = {
        restaurant: [
            { id: 'b_type', type: 'single', keyword: 'é¤å…ç±»å‹', text: 'æ‚¨ç»è¥çš„é¤å…å±äºå“ªä¸€ç±»ï¼Ÿ', options: ['çƒ§çƒ¤/å¤§æ’æ¡£', 'ä¸­å¼æ­£é¤', 'ç«é”…/ä¸²ä¸²', 'å¿«é¤/ç®€é¤', 'æµ·é²œç‰¹è‰²åº—', 'è‡ªåŠ©é¤'] },
            { id: 'b_current', type: 'single', keyword: 'ç›®å‰ç”¨æ–™', text: 'åº—å†…ä¸»è¦ä½¿ç”¨å“ªç§å½¢æ€çš„ç‰¡è›ï¼Ÿ', options: ['å¸¦å£³é²œæ´»', 'å†·å†»åŠå£³', 'å†·å†»çº¯è‚‰', 'æœªä½¿ç”¨'] },
            { id: 'b_pain', type: 'multiple', keyword: 'ä¸»è¦ç—›ç‚¹', text: 'ä½¿ç”¨é²œæ´»ç‰¡è›æ—¶æœ€å¤§çš„éº»çƒ¦ï¼Ÿ(å¤šé€‰)', options: ['äººå·¥å¼€å£³éš¾', 'æ­»äº¡æŸè€—é«˜', 'å¤§å°ä¸å‡', 'è‚¥åº¦ä¸ç¨³å®š', 'æœ‰ç©ºå£³/æ³¥æ²™'] },
            { id: 'b_dish', type: 'multiple', keyword: 'é¢„è®¡åšæ³•', text: 'å¦‚æœç”¨è¿™æ¬¾å†·å†»è‚‰ï¼Œè®¡åˆ’åšä»€ä¹ˆèœï¼Ÿ', options: ['èšµä»”ç…/é…¥ç‚¸', 'æµ·é²œç²¥/æ±¤', 'ç«é”…æ¶®ç…®', 'ä¸­å¼çˆ†ç‚’', 'é”¡çº¸/è’œè“‰çƒ¤'] },
            { id: 'b_pack', type: 'single', keyword: 'åŒ…è£…è§„æ ¼', text: 'å“ªç§å¤§å°æ–¹ä¾¿åå¨æ§æœ¬ï¼Ÿ(æ‰“æ ·250g)', options: ['250g (å°ä»½)', '500g (æ ‡å‡†)', '1kg (å¤§åŒ…)', '2.5kg (é‡è´©)'] },
            { id: 'b_price', type: 'slider', keyword: 'å¿ƒç†ä»·ä½', text: '250g/ç›’ (çº¦25ç²’) åˆç†è¿›è´§ä»·ï¼Ÿ', min: 5, max: 20 },
            { id: 'b_premium', type: 'single', keyword: 'æº¢ä»·æ„æ„¿', text: 'è‹¥åšåˆ°â€œä¸ç ´è‚šã€æ˜“è§£å†»â€ï¼Œæ„¿åŠ ä»·å—ï¼Ÿ', options: ['ä¸åŠ ä»·', 'åŠ  0.5-1å…ƒ', 'åŠ  1-2å…ƒ', 'åŠ  2å…ƒä»¥ä¸Š'] },
            { id: 'b_vol', type: 'single', keyword: 'æœˆé‡‡è´­é‡', text: 'è‹¥è¯•èœæ»¡æ„ï¼Œé¢„ä¼°ç”¨é‡ï¼Ÿ', options: ['50æ–¤å†…', '50-200æ–¤', '200-500æ–¤', '500æ–¤+'] },
            { id: 'b_factor', type: 'multiple', keyword: 'ä¾›åº”å•†', text: 'é€‰ä¾›åº”å•†æœ€çœ‹é‡å“ªä¸¤ç‚¹ï¼Ÿ', options: ['ä»·æ ¼ä¾¿å®œ', 'ä¾›è´§ç¨³å®š', 'å“è´¨ä¸€è‡´', 'è´¦æœŸç»“ç®—', 'å”®åæœåŠ¡'] },
            { id: 'b_contact', type: 'text', keyword: 'è”ç³»æ–¹å¼', text: 'å¦‚æœ‰æ„è¯•æ ·ï¼Œè¯·ç•™ç”µè¯/åº—å', optional: true }
        ],
        consumer: [
            { id: 'c_freq', type: 'single', keyword: 'é£Ÿç”¨é¢‘ç‡', text: 'å¹³æ—¶å¤šä¹…åƒä¸€æ¬¡ç‰¡è›/ç”Ÿèšï¼Ÿ', options: ['æ¯å‘¨åƒ', 'æ¯æœˆ1-2æ¬¡', 'å‡ ä¸ªæœˆä¸€æ¬¡', 'å‡ ä¹ä¸åƒ'] },
            { id: 'c_habit', type: 'single', keyword: 'å¤„ç†ä¹ æƒ¯', text: 'åœ¨å®¶å¤„ç†æµ·é²œçš„æƒ…å†µï¼Ÿ', options: ['ç»å¸¸è‡ªå·±åš', 'å¶å°”å°è¯•', 'å«Œéº»çƒ¦/è„', 'åªåƒå¤–å–'] },
            { id: 'c_accept', type: 'single', keyword: 'æ¥å—åº¦', text: 'èƒ½æ¥å—â€œå»å£³çº¯è‚‰ç›’å†»â€å—ï¼Ÿ', options: ['éå¸¸å–œæ¬¢', 'å¯ä»¥æ¥å—', 'ä¸€èˆ¬', 'åªè®¤é²œæ´»'] },
            { id: 'c_eat', type: 'multiple', keyword: 'æ€ä¹ˆåƒ', text: 'å¦‚æœåœ¨å®¶é‡Œåšï¼Œä¸»è¦åšæ³•ï¼Ÿ', options: ['ç…®æ±¤/ç²¥', 'ç…è›‹/èšµä»”ç…', 'ç«é”…æ¶®èœ', 'ç©ºæ°”ç‚¸é”…', 'çˆ†ç‚’/çº¢çƒ§'] },
            { id: 'c_pack', type: 'single', keyword: 'åŒ…è£…åå¥½', text: 'å®¶åº­å¸¸å¤‡å€¾å‘å¤šå¤§åŒ…è£…ï¼Ÿ', options: ['250g (ä¸€é¡¿)', '500g (ä¸¤é¡¿)', '1kg (å¤§ä»½)'] },
            { id: 'c_price', type: 'slider', keyword: 'å¿ƒç†ä»·ä½', text: '250g/ç›’ èƒ½æ¥å—çš„æ—¥å¸¸ä»·æ ¼ï¼Ÿ', min: 5, max: 20 },
            { id: 'c_prem', type: 'single', keyword: 'å“è´¨æº¢ä»·', text: 'è‹¥åšåˆ°â€œæ˜“è§£å†»ã€ä¸ç ´è‚šâ€ï¼Œæ„¿å¤šä»˜é’±å—ï¼Ÿ', options: ['ä¸æ„¿æ„', 'è´µ 1-2å…ƒ', 'è´µ 3å…ƒä»¥ä¸Š'] },
            { id: 'c_worry', type: 'multiple', keyword: 'æœ€å¤§é¡¾è™‘', text: 'ç½‘è´­å†»å“æœ€æ‹…å¿ƒä»€ä¹ˆï¼Ÿ', options: ['å£æ„Ÿåƒæ£‰èŠ±', 'ç¼©æ°´ä¸¥é‡', 'è…¥å‘³é‡', 'ä¸ªå¤´å¤ªå°', 'è¿è¾“åŒ–å†»'] },
            { id: 'c_buy', type: 'single', keyword: 'è´­ä¹°æ¸ é“', text: 'é€šå¸¸åœ¨å“ªé‡Œä¹°ï¼Ÿ', options: ['ç”Ÿé²œAPP', 'äº¬ä¸œ/æ·˜å®', 'ç¤¾åŒºå›¢è´­', 'èœå¸‚åœº'] },
            { id: 'c_age', type: 'single', keyword: 'å¹´é¾„æ®µ', text: 'æ‚¨çš„å¹´é¾„èŒƒå›´ï¼Ÿ', options: ['18-25å²', '26-35å²', '36-45å²', '46å²ä»¥ä¸Š'] },
            { id: 'c_msg', type: 'text', keyword: 'å»ºè®®ç•™è¨€', text: 'ä»»ä½•å…³äºå£å‘³ã€åŒ…è£…çš„å»ºè®®ï¼Ÿ', optional: true }
        ]
    };

    createApp({
        data() {
            return { step: 0, role: null, answers: {}, tempAnswer: null, isSubmitting: false, submitSuccess: false }
        },
        computed: {
            questions() { return this.role ? surveyDb[this.role] : []; },
            currentQuestion() { 
                if (!this.questions || this.step > this.totalSteps) return {};
                return this.questions[this.step - 1]; 
            },
            totalSteps() { return this.questions.length; },
            progress() { return this.step === 0 ? 0 : Math.round(((this.step - 1) / this.totalSteps) * 100); }
        },
        mounted() {
            // Vue åŠ è½½å®Œæˆåï¼Œç§»é™¤åŠ è½½å±‚ï¼Œæ˜¾ç¤º App
            document.getElementById('loading-mask').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
        },
        methods: {
            startSurvey(role) { this.role = role; this.step = 1; this.initTempAnswer(); },
            initTempAnswer() {
                const q = this.currentQuestion;
                if (!q || !q.type) return; 
                if (q.type === 'slider') this.tempAnswer = Math.floor((q.min + q.max) / 2);
                else if (q.type === 'multiple') this.tempAnswer = [];
                else this.tempAnswer = '';
            },
            isCompact(options) { return options.every(opt => opt.length < 9); },
            handleOptionClick(opt, type) {
                if (type === 'single') {
                    this.tempAnswer = opt;
                    setTimeout(() => { this.nextStep() }, 150);
                } else if (type === 'multiple') {
                    const idx = this.tempAnswer.indexOf(opt);
                    idx > -1 ? this.tempAnswer.splice(idx, 1) : this.tempAnswer.push(opt);
                }
            },
            isSelected(opt) { return Array.isArray(this.tempAnswer) ? this.tempAnswer.includes(opt) : this.tempAnswer === opt; },
            prevStep() { this.step > 1 ? (this.step--, this.initTempAnswer()) : this.step = 0; },
            nextStep() {
                if (!this.currentQuestion.optional) {
                    if (!this.tempAnswer || (Array.isArray(this.tempAnswer) && this.tempAnswer.length === 0)) return;
                }
                this.answers[this.currentQuestion.id] = this.tempAnswer;
                if(this.step < this.totalSteps) {
                    this.step++;
                    this.initTempAnswer();
                } else {
                    this.submitData();
                }
            },
            getNextBtnText() {
                if (this.step === this.totalSteps) return 'æäº¤';
                if (this.currentQuestion.optional && (!this.tempAnswer || this.tempAnswer.length===0)) return 'è·³è¿‡';
                return 'ä¸‹ä¸€é¢˜';
            },
            async submitData() {
                this.step = this.totalSteps + 1; // ç«‹å³åˆ‡é¡µé¢ï¼Œé˜²æ­¢ç™½å±
                this.isSubmitting = true;
                
                // æ¸…æ´—æ•°æ®ï¼šåªä¼ æœ‰ç”¨çš„ï¼Œç©ºå€¼è®¾ä¸ºç©ºå­—ç¬¦ä¸²
                const cleanAnswers = JSON.parse(JSON.stringify(this.answers));
                for(let k in cleanAnswers) if(cleanAnswers[k] == null) cleanAnswers[k] = "";

                const finalData = { 
                    role: this.role === 'restaurant' ? 'Bç«¯é¤é¥®' : 'Cç«¯æ¶ˆè´¹è€…', 
                    timestamp: new Date(), 
                    ...cleanAnswers 
                };

                // æ ¸å¿ƒä¸Šä¼ é€»è¾‘ï¼šçœŸå®ç­‰å¾…ï¼Œä¸è™šå‡
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'X-LC-Id': APP_ID, 'X-LC-Key': APP_KEY, 'Content-Type': 'application/json' },
                        body: JSON.stringify(finalData),
                        keepalive: true // å…³é”®ï¼šå…è®¸åå°ä¼ è¾“
                    });

                    if (response.ok) {
                        this.submitSuccess = true;
                        this.isSubmitting = false;
                    } else { throw new Error("HTTP " + response.status); }
                } catch (error) {
                    console.error("Upload Error:", error);
                    // åªæœ‰çœŸçš„å¤±è´¥äº†ï¼Œæ‰æ˜¾ç¤ºå¤±è´¥é¡µ
                    this.isSubmitting = false;
                    this.submitSuccess = false;
                }
            },
            exportCSV() {
                let csvContent = "\uFEFFKey,Value\n";
                for (const [key, value] of Object.entries(this.answers)) {
                    let valStr = Array.isArray(value) ? value.join(';') : (value || "");
                    csvContent += `${key},"${valStr.toString().replace(/\n/g, " ")}"\n`;
                }
                const link = document.createElement("a");
                link.href = URL.createObjectURL(new Blob([csvContent], { type: 'text/csv;charset=utf-8;' }));
                link.download = `data_${Date.now()}.csv`;
                link.click();
            },
            resetSurvey() { this.step = 0; this.role = null; this.answers = {}; this.submitSuccess = false; }
        }
    }).mount('#app');
</script>
</body>
</html>
